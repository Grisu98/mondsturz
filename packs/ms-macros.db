{"name":"Schaden errechnen","type":"script","scope":"global","author":"laqaCPuaRmrm62CQ","img":"icons/svg/blood.svg","command":"let targetToken = canvas.tokens.controlled;\nif(targetToken.length !== 1) {\n    ui.notifications.warn(\"Es sind mehr als ein Token ausgewählt oder kein Token ausgewählt\")\n    return\n}\nlet targetActor =targetToken[0].actor;\n\nlet [updateData, apply] = await MondsturzUtils.takeDamage(targetActor );\n\nconsole.log(updateData,apply)\n\n        if (apply) {\n            Object.keys(updateData).forEach(async (key) => {\n                let prop = updateData[key];\n                if (prop < 0) {\n                    prop = 0;\n                }\n                switch (key) {\n                    case \"hyper\":\n                        await targetActor.update({ \"system.attribute.koerper.hyperarmor.wert\": prop })\n                        break;\n                    case \"leben\":\n                        await targetActor.update({ \"system.attribute.koerper.leben.wert\": prop })\n\n                        break;\n                    case \"zustand\":\n                        await targetActor.update({ \"system.attribute.koerper.ruestwert.wert\": prop })\n\n                        break;\n                    case \"physis\":\n                        await targetActor.update({ \"system.attribute.koerper.physis.wert\": prop })\n\n                        break;\n\n                    default:\n                        break;\n                }\n            })\n        }\n\n        let msgContent = \"\";\n\n        Object.keys(updateData).forEach(async (key) => {\n            let prop = updateData[key];\n            if (prop < 0) {prop = 0};\n            msgContent += `${key} : ${prop} <br>`\n        })\n\n        let message = await new ChatMessage({\n            content: msgContent,\n            speaker: ChatMessage.getSpeaker(actor)\n        });\n        ChatMessage.create(message)","flags":{"core":{"sourceId":"Macro.0XdnG4cV1WUu8mim"}},"_stats":{"systemId":"mondsturz","systemVersion":"1.3.4","coreVersion":"10.291","createdTime":1683900607563,"modifiedTime":1684146600256,"lastModifiedBy":"laqaCPuaRmrm62CQ"},"folder":null,"sort":0,"ownership":{"default":0,"laqaCPuaRmrm62CQ":3},"_id":"PeT1o4okgJOhg3MV"}
